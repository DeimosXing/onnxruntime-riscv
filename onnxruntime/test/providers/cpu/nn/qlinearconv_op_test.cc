// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

#include "gtest/gtest.h"
#include "test/providers/provider_test_utils.h"

namespace onnxruntime {
namespace test {

namespace {

struct QuantizedTensor {
  QuantizedTensor(const std::vector<float>& data) {
    // find input range min and max
    auto min = *std::min_element(data.begin(), data.end());
    auto max = *std::max_element(data.begin(), data.end());

    // ensure the data range includes zero
    min = std::min(min, 0.f);
    max = std::max(max, 0.f);

    float qmin = std::numeric_limits<uint8_t>::min();
    float qmax = std::numeric_limits<uint8_t>::max();

    // compute scale and zero point
    scale_ = (max - min) / (qmax - qmin);
    const auto initial_zero_point = qmin - min / scale_;
    zero_point_ = static_cast<uint8_t>(std::round(std::max(qmin, std::min(qmax, initial_zero_point))));

    // quantize the data
    quantized_.resize(data.size());
    for (size_t i = 0; i < data.size(); i++) {
      const float clamped_val = std::max(qmin, std::min(qmax, std::round(data[i] / scale_) + zero_point_));
      quantized_[i] = static_cast<uint8_t>(clamped_val);
    }
  }

  QuantizedTensor(const std::vector<uint8_t>& data, float scale, uint8_t zero_point)
      : quantized_(data), scale_(scale), zero_point_(zero_point) {
  }

  std::vector<uint8_t> quantized_;
  float scale_;
  uint8_t zero_point_;
};

struct QuantizedBiasTensor {
  QuantizedBiasTensor(const std::vector<float>& data,
                      const QuantizedTensor& X,
                      const QuantizedTensor& W) {
    scale_ = X.scale_ * W.scale_;

    // quantize the data
    quantized_.resize(data.size());
    for (size_t i = 0; i < data.size(); i++) {
      quantized_[i] = static_cast<int32_t>(std::floor(data[i] / (X.scale_ * W.scale_)));
    }
  }

  QuantizedBiasTensor(const std::vector<int32_t>& data, float scale)
      : quantized_(data), scale_(scale) {
  }

  std::vector<int32_t> quantized_;
  float scale_;
};

void TestQLinearConvOp(OpTester& test,
                       const QuantizedTensor& X,
                       const std::vector<int64_t>& X_shape,
                       const QuantizedTensor& W,
                       const std::vector<int64_t>& W_shape,
                       const QuantizedBiasTensor* B,
                       const QuantizedTensor& Y,
                       const std::vector<int64_t>& Y_shape,
                       const std::unordered_set<std::string>& excluded_provider_types = {}) {

  test.AddInput<uint8_t>("x", X_shape, X.quantized_);
  test.AddInput<float>("x_scale", {}, {X.scale_});
  test.AddInput<uint8_t>("x_zero_point", {}, {X.zero_point_});

  test.AddInput<uint8_t>("w", W_shape, W.quantized_);
  test.AddInput<float>("w_scale", {}, {W.scale_});
  test.AddInput<uint8_t>("w_zero_point", {}, {W.zero_point_});

  test.AddInput<float>("y_scale", {}, {Y.scale_});
  test.AddInput<uint8_t>("y_zero_point", {}, {Y.zero_point_});

  if (B != nullptr) {
    const std::vector<int64_t> B_shape{static_cast<int64_t>(B->quantized_.size())};
    test.AddInput<int32_t>("b", B_shape, B->quantized_);
  }

  test.AddOutput<uint8_t>("y", Y_shape, Y.quantized_);

  test.Run(OpTester::ExpectResult::kExpectSuccess, "", excluded_provider_types);
}

TEST(ConvTest, QLinearConvSignedSimple2DTest) {
  OpTester test("QLinearConv", 10);

  std::vector<int8_t> X = {2, 7, 9, 6, 4, 7, 3, 9, 10, 2, 9, 6, 3, 2, 4, 3, 7, 6, 5, 10, 4, 7, \
                      7, 7, 1, 8, 10, 6, 1, 7, 7, 4, 10, 0, 3, 5, 2, 7, 1, 10, 4, 2, 9, 5, \
                      5, 5, 8, 5, 3, 0, 6, 5, 8, 1, 1, 1, 9, 10, 4, 9, 0, 6, 10, 9, 6, 5, \
                      2, 1, 0, 1, 5, 3, 6, 8, 10, 1, 4, 6, 1, 9, 5, 3, 10, 9, 1, 3, 7, 1, \
                      10, 9, 3, 4, 0, 9, 10, 4, 7, 9, 8, 6, 9, 9, 7, 0, 8, 4, 6, 7, 5, 10, \
                      8, 8, 5, 4, 1, 9, 1, 2, 2, 7, 5, 6, 4, 10, 4, 0, 2, 8, 7, 10, 9, 7, \
                      5, 3, 0, 10, 5, 6, 5, 4, 8, 2, 4, 3, 8, 0, 8, 1, 5, 3, 7, 1, 6, 5, 8, \
                      3, 8, 1, 10, 10, 6, 1, 2, 5, 3, 10, 10, 8, 6, 1, 7, 6, 8, 0, 3, 8, 3, \
                      0, 4, 9, 0, 7, 10, 5, 4, 3, 1, 5, 10, 9, 9, 0, 6, 4, 10, 9, 7, 0, 0, \
                      2, 0, 5, 10, 5, 1, 6, 8, 6, 0, 6, 9, 3, 0, 4, 3, 8, 8, 4, 9, 2, 7, 1, \
                      7, 6, 2, 6, 4, 8, 5, 5, 4, 8, 1, 3, 10, 3, 0, 10, 4, 0, 8, 10, 9, 6, \
                      8, 0, 8, 10, 4, 8, 5, 9, 8, 9, 3, 3, 9, 8, 10, 10, 5, 4, 0, 3, 10, 7, \
                      5, 7, 7, 10, 5, 4, 9, 10, 5, 7, 1, 2, 10, 4, 6, 3, 0, 10, 0, 3, 7, 1, \
                      10, 1, 4, 6, 6, 6, 3, 0, 6, 9, 10, 9, 2, 1, 0, 2, 10, 8, 6, 6, 9, 2, \
                      6, 10, 5, 7, 10, 3, 5, 9, 4, 0, 8, 6, 0, 10, 1, 10, 0, 8, 4, 4, 10, \
                      8, 10, 6, 0, 9, 2, 8, 8, 9, 7, 3, 4, 9, 0, 1, 0, 0, 7, 1, 1, 8, 2, 8, \
                      9, 9, 1, 5, 4, 7, 6};
  std::vector<int64_t> X_shape = {1, 1, 19, 19};

  std::vector<int8_t> W = {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1};
  std::vector<int64_t> W_shape = {16, 1, 4, 4};

  std::vector<int8_t> expected_vals = {23, 24, 23, 22, 26, 27, 24, 22, 18, 14, 17, 16, 16, 18, 17, 19, 22, \
                                  22, 21, 24, 27, 25, 23, 20, 14, 14, 19, 18, 20, 18, 16, 19, 22, 24, \
                                  24, 26, 28, 25, 23, 18, 14, 16, 18, 20, 23, 21, 21, 21, 21, 21, 22, \
                                  25, 27, 25, 24, 19, 14, 16, 18, 19, 24, 26, 27, 26, 20, 22, 22, 24, \
                                  25, 22, 22, 20, 16, 19, 20, 21, 24, 24, 24, 24, 20, 22, 22, 22, 26, \
                                  23, 24, 20, 17, 17, 19, 22, 26, 29, 26, 24, 18, 20, 18, 18, 22, 21, \
                                  21, 20, 19, 16, 20, 21, 21, 24, 23, 24, 19, 21, 22, 22, 23, 20, 17, \
                                  14, 16, 16, 21, 22, 20, 21, 20, 21, 19, 20, 18, 20, 23, 20, 20, 16, \
                                  17, 17, 21, 23, 20, 22, 21, 22, 19, 18, 17, 20, 20, 18, 18, 16, 17, \
                                  20, 21, 23, 21, 22, 20, 22, 22, 20, 21, 24, 24, 20, 21, 16, 18, 24, \
                                  23, 24, 22, 22, 20, 20, 24, 22, 20, 24, 24, 22, 27, 22, 20, 24, 22, \
                                  25, 23, 20, 19, 19, 25, 23, 22, 26, 23, 22, 25, 20, 18, 24, 24, 28, \
                                  26, 20, 18, 15, 27, 26, 24, 26, 25, 24, 26, 23, 21, 25, 26, 26, 22, \
                                  17, 16, 13, 25, 24, 22, 22, 24, 25, 28, 26, 20, 22, 22, 24, 24, 21, \
                                  20, 15, 22, 19, 16, 17, 20, 20, 24, 23, 21, 24, 24, 25, 25, 22, 20, \
                                  17, 23, 24, 23, 22, 26, 27, 24, 22, 18, 14, 17, 16, 16, 18, 17, 19, \
                                  22, 22, 21, 24, 27, 25, 23, 20, 14, 14, 19, 18, 20, 18, 16, 19, 22, \
                                  24, 24, 26, 28, 25, 23, 18, 14, 16, 18, 20, 23, 21, 21, 21, 21, 21, \
                                  22, 25, 27, 25, 24, 19, 14, 16, 18, 19, 24, 26, 27, 26, 20, 22, 22, \
                                  24, 25, 22, 22, 20, 16, 19, 20, 21, 24, 24, 24, 24, 20, 22, 22, 22, \
                                  26, 23, 24, 20, 17, 17, 19, 22, 26, 29, 26, 24, 18, 20, 18, 18, 22, \
                                  21, 21, 20, 19, 16, 20, 21, 21, 24, 23, 24, 19, 21, 22, 22, 23, 20, \
                                  17, 14, 16, 16, 21, 22, 20, 21, 20, 21, 19, 20, 18, 20, 23, 20, 20, \
                                  16, 17, 17, 21, 23, 20, 22, 21, 22, 19, 18, 17, 20, 20, 18, 18, 16, \
                                  17, 20, 21, 23, 21, 22, 20, 22, 22, 20, 21, 24, 24, 20, 21, 16, 18, \
                                  24, 23, 24, 22, 22, 20, 20, 24, 22, 20, 24, 24, 22, 27, 22, 20, 24, \
                                  22, 25, 23, 20, 19, 19, 25, 23, 22, 26, 23, 22, 25, 20, 18, 24, 24, \
                                  28, 26, 20, 18, 15, 27, 26, 24, 26, 25, 24, 26, 23, 21, 25, 26, 26, \
                                  22, 17, 16, 13, 25, 24, 22, 22, 24, 25, 28, 26, 20, 22, 22, 24, 24, \
                                  21, 20, 15, 22, 19, 16, 17, 20, 20, 24, 23, 21, 24, 24, 25, 25, 22, \
                                  20, 17, 23, 24, 23, 22, 26, 27, 24, 22, 18, 14, 17, 16, 16, 18, 17, \
                                  19, 22, 22, 21, 24, 27, 25, 23, 20, 14, 14, 19, 18, 20, 18, 16, 19, \
                                  22, 24, 24, 26, 28, 25, 23, 18, 14, 16, 18, 20, 23, 21, 21, 21, 21, \
                                  21, 22, 25, 27, 25, 24, 19, 14, 16, 18, 19, 24, 26, 27, 26, 20, 22, \
                                  22, 24, 25, 22, 22, 20, 16, 19, 20, 21, 24, 24, 24, 24, 20, 22, 22, \
                                  22, 26, 23, 24, 20, 17, 17, 19, 22, 26, 29, 26, 24, 18, 20, 18, 18, \
                                  22, 21, 21, 20, 19, 16, 20, 21, 21, 24, 23, 24, 19, 21, 22, 22, 23, \
                                  20, 17, 14, 16, 16, 21, 22, 20, 21, 20, 21, 19, 20, 18, 20, 23, 20, \
                                  20, 16, 17, 17, 21, 23, 20, 22, 21, 22, 19, 18, 17, 20, 20, 18, 18, \
                                  16, 17, 20, 21, 23, 21, 22, 20, 22, 22, 20, 21, 24, 24, 20, 21, 16, \
                                  18, 24, 23, 24, 22, 22, 20, 20, 24, 22, 20, 24, 24, 22, 27, 22, 20, \
                                  24, 22, 25, 23, 20, 19, 19, 25, 23, 22, 26, 23, 22, 25, 20, 18, 24, \
                                  24, 28, 26, 20, 18, 15, 27, 26, 24, 26, 25, 24, 26, 23, 21, 25, 26, \
                                  26, 22, 17, 16, 13, 25, 24, 22, 22, 24, 25, 28, 26, 20, 22, 22, 24, \
                                  24, 21, 20, 15, 22, 19, 16, 17, 20, 20, 24, 23, 21, 24, 24, 25, 25, \
                                  22, 20, 17, 23, 24, 23, 22, 26, 27, 24, 22, 18, 14, 17, 16, 16, 18, \
                                  17, 19, 22, 22, 21, 24, 27, 25, 23, 20, 14, 14, 19, 18, 20, 18, 16, \
                                  19, 22, 24, 24, 26, 28, 25, 23, 18, 14, 16, 18, 20, 23, 21, 21, 21, \
                                  21, 21, 22, 25, 27, 25, 24, 19, 14, 16, 18, 19, 24, 26, 27, 26, 20, \
                                  22, 22, 24, 25, 22, 22, 20, 16, 19, 20, 21, 24, 24, 24, 24, 20, 22, \
                                  22, 22, 26, 23, 24, 20, 17, 17, 19, 22, 26, 29, 26, 24, 18, 20, 18, \
                                  18, 22, 21, 21, 20, 19, 16, 20, 21, 21, 24, 23, 24, 19, 21, 22, 22, \
                                  23, 20, 17, 14, 16, 16, 21, 22, 20, 21, 20, 21, 19, 20, 18, 20, 23, \
                                  20, 20, 16, 17, 17, 21, 23, 20, 22, 21, 22, 19, 18, 17, 20, 20, 18, \
                                  18, 16, 17, 20, 21, 23, 21, 22, 20, 22, 22, 20, 21, 24, 24, 20, 21, \
                                  16, 18, 24, 23, 24, 22, 22, 20, 20, 24, 22, 20, 24, 24, 22, 27, 22, \
                                  20, 24, 22, 25, 23, 20, 19, 19, 25, 23, 22, 26, 23, 22, 25, 20, 18, \
                                  24, 24, 28, 26, 20, 18, 15, 27, 26, 24, 26, 25, 24, 26, 23, 21, 25, \
                                  26, 26, 22, 17, 16, 13, 25, 24, 22, 22, 24, 25, 28, 26, 20, 22, 22, \
                                  24, 24, 21, 20, 15, 22, 19, 16, 17, 20, 20, 24, 23, 21, 24, 24, 25, \
                                  25, 22, 20, 17, 23, 24, 23, 22, 26, 27, 24, 22, 18, 14, 17, 16, 16, \
                                  18, 17, 19, 22, 22, 21, 24, 27, 25, 23, 20, 14, 14, 19, 18, 20, 18, \
                                  16, 19, 22, 24, 24, 26, 28, 25, 23, 18, 14, 16, 18, 20, 23, 21, 21, \
                                  21, 21, 21, 22, 25, 27, 25, 24, 19, 14, 16, 18, 19, 24, 26, 27, 26, \
                                  20, 22, 22, 24, 25, 22, 22, 20, 16, 19, 20, 21, 24, 24, 24, 24, 20, \
                                  22, 22, 22, 26, 23, 24, 20, 17, 17, 19, 22, 26, 29, 26, 24, 18, 20, \
                                  18, 18, 22, 21, 21, 20, 19, 16, 20, 21, 21, 24, 23, 24, 19, 21, 22, \
                                  22, 23, 20, 17, 14, 16, 16, 21, 22, 20, 21, 20, 21, 19, 20, 18, 20, \
                                  23, 20, 20, 16, 17, 17, 21, 23, 20, 22, 21, 22, 19, 18, 17, 20, 20, \
                                  18, 18, 16, 17, 20, 21, 23, 21, 22, 20, 22, 22, 20, 21, 24, 24, 20, \
                                  21, 16, 18, 24, 23, 24, 22, 22, 20, 20, 24, 22, 20, 24, 24, 22, 27, \
                                  22, 20, 24, 22, 25, 23, 20, 19, 19, 25, 23, 22, 26, 23, 22, 25, 20, \
                                  18, 24, 24, 28, 26, 20, 18, 15, 27, 26, 24, 26, 25, 24, 26, 23, 21, \
                                  25, 26, 26, 22, 17, 16, 13, 25, 24, 22, 22, 24, 25, 28, 26, 20, 22, \
                                  22, 24, 24, 21, 20, 15, 22, 19, 16, 17, 20, 20, 24, 23, 21, 24, 24, \
                                  25, 25, 22, 20, 17, 23, 24, 23, 22, 26, 27, 24, 22, 18, 14, 17, 16, \
                                  16, 18, 17, 19, 22, 22, 21, 24, 27, 25, 23, 20, 14, 14, 19, 18, 20, \
                                  18, 16, 19, 22, 24, 24, 26, 28, 25, 23, 18, 14, 16, 18, 20, 23, 21, \
                                  21, 21, 21, 21, 22, 25, 27, 25, 24, 19, 14, 16, 18, 19, 24, 26, 27, \
                                  26, 20, 22, 22, 24, 25, 22, 22, 20, 16, 19, 20, 21, 24, 24, 24, 24, \
                                  20, 22, 22, 22, 26, 23, 24, 20, 17, 17, 19, 22, 26, 29, 26, 24, 18, \
                                  20, 18, 18, 22, 21, 21, 20, 19, 16, 20, 21, 21, 24, 23, 24, 19, 21, \
                                  22, 22, 23, 20, 17, 14, 16, 16, 21, 22, 20, 21, 20, 21, 19, 20, 18, \
                                  20, 23, 20, 20, 16, 17, 17, 21, 23, 20, 22, 21, 22, 19, 18, 17, 20, \
                                  20, 18, 18, 16, 17, 20, 21, 23, 21, 22, 20, 22, 22, 20, 21, 24, 24, \
                                  20, 21, 16, 18, 24, 23, 24, 22, 22, 20, 20, 24, 22, 20, 24, 24, 22, \
                                  27, 22, 20, 24, 22, 25, 23, 20, 19, 19, 25, 23, 22, 26, 23, 22, 25, \
                                  20, 18, 24, 24, 28, 26, 20, 18, 15, 27, 26, 24, 26, 25, 24, 26, 23, \
                                  21, 25, 26, 26, 22, 17, 16, 13, 25, 24, 22, 22, 24, 25, 28, 26, 20, \
                                  22, 22, 24, 24, 21, 20, 15, 22, 19, 16, 17, 20, 20, 24, 23, 21, 24, \
                                  24, 25, 25, 22, 20, 17, 23, 24, 23, 22, 26, 27, 24, 22, 18, 14, 17, \
                                  16, 16, 18, 17, 19, 22, 22, 21, 24, 27, 25, 23, 20, 14, 14, 19, 18, \
                                  20, 18, 16, 19, 22, 24, 24, 26, 28, 25, 23, 18, 14, 16, 18, 20, 23, \
                                  21, 21, 21, 21, 21, 22, 25, 27, 25, 24, 19, 14, 16, 18, 19, 24, 26, \
                                  27, 26, 20, 22, 22, 24, 25, 22, 22, 20, 16, 19, 20, 21, 24, 24, 24, \
                                  24, 20, 22, 22, 22, 26, 23, 24, 20, 17, 17, 19, 22, 26, 29, 26, 24, \
                                  18, 20, 18, 18, 22, 21, 21, 20, 19, 16, 20, 21, 21, 24, 23, 24, 19, \
                                  21, 22, 22, 23, 20, 17, 14, 16, 16, 21, 22, 20, 21, 20, 21, 19, 20, \
                                  18, 20, 23, 20, 20, 16, 17, 17, 21, 23, 20, 22, 21, 22, 19, 18, 17, \
                                  20, 20, 18, 18, 16, 17, 20, 21, 23, 21, 22, 20, 22, 22, 20, 21, 24, \
                                  24, 20, 21, 16, 18, 24, 23, 24, 22, 22, 20, 20, 24, 22, 20, 24, 24, \
                                  22, 27, 22, 20, 24, 22, 25, 23, 20, 19, 19, 25, 23, 22, 26, 23, 22, \
                                  25, 20, 18, 24, 24, 28, 26, 20, 18, 15, 27, 26, 24, 26, 25, 24, 26, \
                                  23, 21, 25, 26, 26, 22, 17, 16, 13, 25, 24, 22, 22, 24, 25, 28, 26, \
                                  20, 22, 22, 24, 24, 21, 20, 15, 22, 19, 16, 17, 20, 20, 24, 23, 21, \
                                  24, 24, 25, 25, 22, 20, 17, 23, 24, 23, 22, 26, 27, 24, 22, 18, 14, \
                                  17, 16, 16, 18, 17, 19, 22, 22, 21, 24, 27, 25, 23, 20, 14, 14, 19, \
                                  18, 20, 18, 16, 19, 22, 24, 24, 26, 28, 25, 23, 18, 14, 16, 18, 20, \
                                  23, 21, 21, 21, 21, 21, 22, 25, 27, 25, 24, 19, 14, 16, 18, 19, 24, \
                                  26, 27, 26, 20, 22, 22, 24, 25, 22, 22, 20, 16, 19, 20, 21, 24, 24, \
                                  24, 24, 20, 22, 22, 22, 26, 23, 24, 20, 17, 17, 19, 22, 26, 29, 26, \
                                  24, 18, 20, 18, 18, 22, 21, 21, 20, 19, 16, 20, 21, 21, 24, 23, 24, \
                                  19, 21, 22, 22, 23, 20, 17, 14, 16, 16, 21, 22, 20, 21, 20, 21, 19, \
                                  20, 18, 20, 23, 20, 20, 16, 17, 17, 21, 23, 20, 22, 21, 22, 19, 18, \
                                  17, 20, 20, 18, 18, 16, 17, 20, 21, 23, 21, 22, 20, 22, 22, 20, 21, \
                                  24, 24, 20, 21, 16, 18, 24, 23, 24, 22, 22, 20, 20, 24, 22, 20, 24, \
                                  24, 22, 27, 22, 20, 24, 22, 25, 23, 20, 19, 19, 25, 23, 22, 26, 23, \
                                  22, 25, 20, 18, 24, 24, 28, 26, 20, 18, 15, 27, 26, 24, 26, 25, 24, \
                                  26, 23, 21, 25, 26, 26, 22, 17, 16, 13, 25, 24, 22, 22, 24, 25, 28, \
                                  26, 20, 22, 22, 24, 24, 21, 20, 15, 22, 19, 16, 17, 20, 20, 24, 23, \
                                  21, 24, 24, 25, 25, 22, 20, 17, 23, 24, 23, 22, 26, 27, 24, 22, 18, \
                                  14, 17, 16, 16, 18, 17, 19, 22, 22, 21, 24, 27, 25, 23, 20, 14, 14, \
                                  19, 18, 20, 18, 16, 19, 22, 24, 24, 26, 28, 25, 23, 18, 14, 16, 18, \
                                  20, 23, 21, 21, 21, 21, 21, 22, 25, 27, 25, 24, 19, 14, 16, 18, 19, \
                                  24, 26, 27, 26, 20, 22, 22, 24, 25, 22, 22, 20, 16, 19, 20, 21, 24, \
                                  24, 24, 24, 20, 22, 22, 22, 26, 23, 24, 20, 17, 17, 19, 22, 26, 29, \
                                  26, 24, 18, 20, 18, 18, 22, 21, 21, 20, 19, 16, 20, 21, 21, 24, 23, \
                                  24, 19, 21, 22, 22, 23, 20, 17, 14, 16, 16, 21, 22, 20, 21, 20, 21, \
                                  19, 20, 18, 20, 23, 20, 20, 16, 17, 17, 21, 23, 20, 22, 21, 22, 19, \
                                  18, 17, 20, 20, 18, 18, 16, 17, 20, 21, 23, 21, 22, 20, 22, 22, 20, \
                                  21, 24, 24, 20, 21, 16, 18, 24, 23, 24, 22, 22, 20, 20, 24, 22, 20, \
                                  24, 24, 22, 27, 22, 20, 24, 22, 25, 23, 20, 19, 19, 25, 23, 22, 26, \
                                  23, 22, 25, 20, 18, 24, 24, 28, 26, 20, 18, 15, 27, 26, 24, 26, 25, \
                                  24, 26, 23, 21, 25, 26, 26, 22, 17, 16, 13, 25, 24, 22, 22, 24, 25, \
                                  28, 26, 20, 22, 22, 24, 24, 21, 20, 15, 22, 19, 16, 17, 20, 20, 24, \
                                  23, 21, 24, 24, 25, 25, 22, 20, 17, 23, 24, 23, 22, 26, 27, 24, 22, \
                                  18, 14, 17, 16, 16, 18, 17, 19, 22, 22, 21, 24, 27, 25, 23, 20, 14, \
                                  14, 19, 18, 20, 18, 16, 19, 22, 24, 24, 26, 28, 25, 23, 18, 14, 16, \
                                  18, 20, 23, 21, 21, 21, 21, 21, 22, 25, 27, 25, 24, 19, 14, 16, 18, \
                                  19, 24, 26, 27, 26, 20, 22, 22, 24, 25, 22, 22, 20, 16, 19, 20, 21, \
                                  24, 24, 24, 24, 20, 22, 22, 22, 26, 23, 24, 20, 17, 17, 19, 22, 26, \
                                  29, 26, 24, 18, 20, 18, 18, 22, 21, 21, 20, 19, 16, 20, 21, 21, 24, \
                                  23, 24, 19, 21, 22, 22, 23, 20, 17, 14, 16, 16, 21, 22, 20, 21, 20, \
                                  21, 19, 20, 18, 20, 23, 20, 20, 16, 17, 17, 21, 23, 20, 22, 21, 22, \
                                  19, 18, 17, 20, 20, 18, 18, 16, 17, 20, 21, 23, 21, 22, 20, 22, 22, \
                                  20, 21, 24, 24, 20, 21, 16, 18, 24, 23, 24, 22, 22, 20, 20, 24, 22, \
                                  20, 24, 24, 22, 27, 22, 20, 24, 22, 25, 23, 20, 19, 19, 25, 23, 22, \
                                  26, 23, 22, 25, 20, 18, 24, 24, 28, 26, 20, 18, 15, 27, 26, 24, 26, \
                                  25, 24, 26, 23, 21, 25, 26, 26, 22, 17, 16, 13, 25, 24, 22, 22, 24, \
                                  25, 28, 26, 20, 22, 22, 24, 24, 21, 20, 15, 22, 19, 16, 17, 20, 20, \
                                  24, 23, 21, 24, 24, 25, 25, 22, 20, 17, 23, 24, 23, 22, 26, 27, 24, \
                                  22, 18, 14, 17, 16, 16, 18, 17, 19, 22, 22, 21, 24, 27, 25, 23, 20, \
                                  14, 14, 19, 18, 20, 18, 16, 19, 22, 24, 24, 26, 28, 25, 23, 18, 14, \
                                  16, 18, 20, 23, 21, 21, 21, 21, 21, 22, 25, 27, 25, 24, 19, 14, 16, \
                                  18, 19, 24, 26, 27, 26, 20, 22, 22, 24, 25, 22, 22, 20, 16, 19, 20, \
                                  21, 24, 24, 24, 24, 20, 22, 22, 22, 26, 23, 24, 20, 17, 17, 19, 22, \
                                  26, 29, 26, 24, 18, 20, 18, 18, 22, 21, 21, 20, 19, 16, 20, 21, 21, \
                                  24, 23, 24, 19, 21, 22, 22, 23, 20, 17, 14, 16, 16, 21, 22, 20, 21, \
                                  20, 21, 19, 20, 18, 20, 23, 20, 20, 16, 17, 17, 21, 23, 20, 22, 21, \
                                  22, 19, 18, 17, 20, 20, 18, 18, 16, 17, 20, 21, 23, 21, 22, 20, 22, \
                                  22, 20, 21, 24, 24, 20, 21, 16, 18, 24, 23, 24, 22, 22, 20, 20, 24, \
                                  22, 20, 24, 24, 22, 27, 22, 20, 24, 22, 25, 23, 20, 19, 19, 25, 23, \
                                  22, 26, 23, 22, 25, 20, 18, 24, 24, 28, 26, 20, 18, 15, 27, 26, 24, \
                                  26, 25, 24, 26, 23, 21, 25, 26, 26, 22, 17, 16, 13, 25, 24, 22, 22, \
                                  24, 25, 28, 26, 20, 22, 22, 24, 24, 21, 20, 15, 22, 19, 16, 17, 20, \
                                  20, 24, 23, 21, 24, 24, 25, 25, 22, 20, 17, 23, 24, 23, 22, 26, 27, \
                                  24, 22, 18, 14, 17, 16, 16, 18, 17, 19, 22, 22, 21, 24, 27, 25, 23, \
                                  20, 14, 14, 19, 18, 20, 18, 16, 19, 22, 24, 24, 26, 28, 25, 23, 18, \
                                  14, 16, 18, 20, 23, 21, 21, 21, 21, 21, 22, 25, 27, 25, 24, 19, 14, \
                                  16, 18, 19, 24, 26, 27, 26, 20, 22, 22, 24, 25, 22, 22, 20, 16, 19, \
                                  20, 21, 24, 24, 24, 24, 20, 22, 22, 22, 26, 23, 24, 20, 17, 17, 19, \
                                  22, 26, 29, 26, 24, 18, 20, 18, 18, 22, 21, 21, 20, 19, 16, 20, 21, \
                                  21, 24, 23, 24, 19, 21, 22, 22, 23, 20, 17, 14, 16, 16, 21, 22, 20, \
                                  21, 20, 21, 19, 20, 18, 20, 23, 20, 20, 16, 17, 17, 21, 23, 20, 22, \
                                  21, 22, 19, 18, 17, 20, 20, 18, 18, 16, 17, 20, 21, 23, 21, 22, 20, \
                                  22, 22, 20, 21, 24, 24, 20, 21, 16, 18, 24, 23, 24, 22, 22, 20, 20, \
                                  24, 22, 20, 24, 24, 22, 27, 22, 20, 24, 22, 25, 23, 20, 19, 19, 25, \
                                  23, 22, 26, 23, 22, 25, 20, 18, 24, 24, 28, 26, 20, 18, 15, 27, 26, \
                                  24, 26, 25, 24, 26, 23, 21, 25, 26, 26, 22, 17, 16, 13, 25, 24, 22, \
                                  22, 24, 25, 28, 26, 20, 22, 22, 24, 24, 21, 20, 15, 22, 19, 16, 17, \
                                  20, 20, 24, 23, 21, 24, 24, 25, 25, 22, 20, 17, 23, 24, 23, 22, 26, \
                                  27, 24, 22, 18, 14, 17, 16, 16, 18, 17, 19, 22, 22, 21, 24, 27, 25, \
                                  23, 20, 14, 14, 19, 18, 20, 18, 16, 19, 22, 24, 24, 26, 28, 25, 23, \
                                  18, 14, 16, 18, 20, 23, 21, 21, 21, 21, 21, 22, 25, 27, 25, 24, 19, \
                                  14, 16, 18, 19, 24, 26, 27, 26, 20, 22, 22, 24, 25, 22, 22, 20, 16, \
                                  19, 20, 21, 24, 24, 24, 24, 20, 22, 22, 22, 26, 23, 24, 20, 17, 17, \
                                  19, 22, 26, 29, 26, 24, 18, 20, 18, 18, 22, 21, 21, 20, 19, 16, 20, \
                                  21, 21, 24, 23, 24, 19, 21, 22, 22, 23, 20, 17, 14, 16, 16, 21, 22, \
                                  20, 21, 20, 21, 19, 20, 18, 20, 23, 20, 20, 16, 17, 17, 21, 23, 20, \
                                  22, 21, 22, 19, 18, 17, 20, 20, 18, 18, 16, 17, 20, 21, 23, 21, 22, \
                                  20, 22, 22, 20, 21, 24, 24, 20, 21, 16, 18, 24, 23, 24, 22, 22, 20, \
                                  20, 24, 22, 20, 24, 24, 22, 27, 22, 20, 24, 22, 25, 23, 20, 19, 19, \
                                  25, 23, 22, 26, 23, 22, 25, 20, 18, 24, 24, 28, 26, 20, 18, 15, 27, \
                                  26, 24, 26, 25, 24, 26, 23, 21, 25, 26, 26, 22, 17, 16, 13, 25, 24, \
                                  22, 22, 24, 25, 28, 26, 20, 22, 22, 24, 24, 21, 20, 15, 22, 19, 16, \
                                  17, 20, 20, 24, 23, 21, 24, 24, 25, 25, 22, 20, 17, 23, 24, 23, 22, \
                                  26, 27, 24, 22, 18, 14, 17, 16, 16, 18, 17, 19, 22, 22, 21, 24, 27, \
                                  25, 23, 20, 14, 14, 19, 18, 20, 18, 16, 19, 22, 24, 24, 26, 28, 25, \
                                  23, 18, 14, 16, 18, 20, 23, 21, 21, 21, 21, 21, 22, 25, 27, 25, 24, \
                                  19, 14, 16, 18, 19, 24, 26, 27, 26, 20, 22, 22, 24, 25, 22, 22, 20, \
                                  16, 19, 20, 21, 24, 24, 24, 24, 20, 22, 22, 22, 26, 23, 24, 20, 17, \
                                  17, 19, 22, 26, 29, 26, 24, 18, 20, 18, 18, 22, 21, 21, 20, 19, 16, \
                                  20, 21, 21, 24, 23, 24, 19, 21, 22, 22, 23, 20, 17, 14, 16, 16, 21, \
                                  22, 20, 21, 20, 21, 19, 20, 18, 20, 23, 20, 20, 16, 17, 17, 21, 23, \
                                  20, 22, 21, 22, 19, 18, 17, 20, 20, 18, 18, 16, 17, 20, 21, 23, 21, \
                                  22, 20, 22, 22, 20, 21, 24, 24, 20, 21, 16, 18, 24, 23, 24, 22, 22, \
                                  20, 20, 24, 22, 20, 24, 24, 22, 27, 22, 20, 24, 22, 25, 23, 20, 19, \
                                  19, 25, 23, 22, 26, 23, 22, 25, 20, 18, 24, 24, 28, 26, 20, 18, 15, \
                                  27, 26, 24, 26, 25, 24, 26, 23, 21, 25, 26, 26, 22, 17, 16, 13, 25, \
                                  24, 22, 22, 24, 25, 28, 26, 20, 22, 22, 24, 24, 21, 20, 15, 22, 19, \
                                  16, 17, 20, 20, 24, 23, 21, 24, 24, 25, 25, 22, 20, 17, 23, 24, 23, \
                                  22, 26, 27, 24, 22, 18, 14, 17, 16, 16, 18, 17, 19, 22, 22, 21, 24, \
                                  27, 25, 23, 20, 14, 14, 19, 18, 20, 18, 16, 19, 22, 24, 24, 26, 28, \
                                  25, 23, 18, 14, 16, 18, 20, 23, 21, 21, 21, 21, 21, 22, 25, 27, 25, \
                                  24, 19, 14, 16, 18, 19, 24, 26, 27, 26, 20, 22, 22, 24, 25, 22, 22, \
                                  20, 16, 19, 20, 21, 24, 24, 24, 24, 20, 22, 22, 22, 26, 23, 24, 20, \
                                  17, 17, 19, 22, 26, 29, 26, 24, 18, 20, 18, 18, 22, 21, 21, 20, 19, \
                                  16, 20, 21, 21, 24, 23, 24, 19, 21, 22, 22, 23, 20, 17, 14, 16, 16, \
                                  21, 22, 20, 21, 20, 21, 19, 20, 18, 20, 23, 20, 20, 16, 17, 17, 21, \
                                  23, 20, 22, 21, 22, 19, 18, 17, 20, 20, 18, 18, 16, 17, 20, 21, 23, \
                                  21, 22, 20, 22, 22, 20, 21, 24, 24, 20, 21, 16, 18, 24, 23, 24, 22, \
                                  22, 20, 20, 24, 22, 20, 24, 24, 22, 27, 22, 20, 24, 22, 25, 23, 20, \
                                  19, 19, 25, 23, 22, 26, 23, 22, 25, 20, 18, 24, 24, 28, 26, 20, 18, \
                                  15, 27, 26, 24, 26, 25, 24, 26, 23, 21, 25, 26, 26, 22, 17, 16, 13, \
                                  25, 24, 22, 22, 24, 25, 28, 26, 20, 22, 22, 24, 24, 21, 20, 15, 22, \
                                  19, 16, 17, 20, 20, 24, 23, 21, 24, 24, 25, 25, 22, 20, 17, 23, 24, \
                                  23, 22, 26, 27, 24, 22, 18, 14, 17, 16, 16, 18, 17, 19, 22, 22, 21, \
                                  24, 27, 25, 23, 20, 14, 14, 19, 18, 20, 18, 16, 19, 22, 24, 24, 26, \
                                  28, 25, 23, 18, 14, 16, 18, 20, 23, 21, 21, 21, 21, 21, 22, 25, 27, \
                                  25, 24, 19, 14, 16, 18, 19, 24, 26, 27, 26, 20, 22, 22, 24, 25, 22, \
                                  22, 20, 16, 19, 20, 21, 24, 24, 24, 24, 20, 22, 22, 22, 26, 23, 24, \
                                  20, 17, 17, 19, 22, 26, 29, 26, 24, 18, 20, 18, 18, 22, 21, 21, 20, \
                                  19, 16, 20, 21, 21, 24, 23, 24, 19, 21, 22, 22, 23, 20, 17, 14, 16, \
                                  16, 21, 22, 20, 21, 20, 21, 19, 20, 18, 20, 23, 20, 20, 16, 17, 17, \
                                  21, 23, 20, 22, 21, 22, 19, 18, 17, 20, 20, 18, 18, 16, 17, 20, 21, \
                                  23, 21, 22, 20, 22, 22, 20, 21, 24, 24, 20, 21, 16, 18, 24, 23, 24, \
                                  22, 22, 20, 20, 24, 22, 20, 24, 24, 22, 27, 22, 20, 24, 22, 25, 23, \
                                  20, 19, 19, 25, 23, 22, 26, 23, 22, 25, 20, 18, 24, 24, 28, 26, 20, \
                                  18, 15, 27, 26, 24, 26, 25, 24, 26, 23, 21, 25, 26, 26, 22, 17, 16, \
                                  13, 25, 24, 22, 22, 24, 25, 28, 26, 20, 22, 22, 24, 24, 21, 20, 15, \
                                  22, 19, 16, 17, 20, 20, 24, 23, 21, 24, 24, 25, 25, 22, 20, 17};
  std::vector<int64_t> Y_shape = {1, 16, 16, 16};

  test.AddInput<int8_t>("x", X_shape, X);
  test.AddInput<float>("x_scale", {}, {1});
  test.AddInput<int8_t>("x_zero_point", {}, {0});

  test.AddInput<int8_t>("w", W_shape, W);
  test.AddInput<float>("w_scale", {}, {1});
  test.AddInput<int8_t>("w_zero_point", {}, {0});

  test.AddInput<float>("y_scale", {}, {4});
  test.AddInput<int8_t>("y_zero_point", {}, {0});

  test.AddOutput<int8_t>("y", Y_shape, expected_vals);

  test.Run();
}

TEST(ConvTest, QLinearConvSignedWithBiasSimple2DTest) {
  OpTester test("QLinearConv", 10);

  std::vector<int8_t> X = {2, 7, 9, 6, 4, 7, 3, 9, 10, 2, 9, 6, 3, 2, 4, 3, 7, 6, 5, 10, 4, 7, \
                      7, 7, 1, 8, 10, 6, 1, 7, 7, 4, 10, 0, 3, 5, 2, 7, 1, 10, 4, 2, 9, 5, \
                      5, 5, 8, 5, 3, 0, 6, 5, 8, 1, 1, 1, 9, 10, 4, 9, 0, 6, 10, 9, 6, 5, \
                      2, 1, 0, 1, 5, 3, 6, 8, 10, 1, 4, 6, 1, 9, 5, 3, 10, 9, 1, 3, 7, 1, \
                      10, 9, 3, 4, 0, 9, 10, 4, 7, 9, 8, 6, 9, 9, 7, 0, 8, 4, 6, 7, 5, 10, \
                      8, 8, 5, 4, 1, 9, 1, 2, 2, 7, 5, 6, 4, 10, 4, 0, 2, 8, 7, 10, 9, 7, \
                      5, 3, 0, 10, 5, 6, 5, 4, 8, 2, 4, 3, 8, 0, 8, 1, 5, 3, 7, 1, 6, 5, 8, \
                      3, 8, 1, 10, 10, 6, 1, 2, 5, 3, 10, 10, 8, 6, 1, 7, 6, 8, 0, 3, 8, 3, \
                      0, 4, 9, 0, 7, 10, 5, 4, 3, 1, 5, 10, 9, 9, 0, 6, 4, 10, 9, 7, 0, 0, \
                      2, 0, 5, 10, 5, 1, 6, 8, 6, 0, 6, 9, 3, 0, 4, 3, 8, 8, 4, 9, 2, 7, 1, \
                      7, 6, 2, 6, 4, 8, 5, 5, 4, 8, 1, 3, 10, 3, 0, 10, 4, 0, 8, 10, 9, 6, \
                      8, 0, 8, 10, 4, 8, 5, 9, 8, 9, 3, 3, 9, 8, 10, 10, 5, 4, 0, 3, 10, 7, \
                      5, 7, 7, 10, 5, 4, 9, 10, 5, 7, 1, 2, 10, 4, 6, 3, 0, 10, 0, 3, 7, 1, \
                      10, 1, 4, 6, 6, 6, 3, 0, 6, 9, 10, 9, 2, 1, 0, 2, 10, 8, 6, 6, 9, 2, \
                      6, 10, 5, 7, 10, 3, 5, 9, 4, 0, 8, 6, 0, 10, 1, 10, 0, 8, 4, 4, 10, \
                      8, 10, 6, 0, 9, 2, 8, 8, 9, 7, 3, 4, 9, 0, 1, 0, 0, 7, 1, 1, 8, 2, 8, \
                      9, 9, 1, 5, 4, 7, 6};
  std::vector<int64_t> X_shape = {1, 1, 19, 19};

  std::vector<int8_t> W = {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, \
                        1, 1, 1};
  std::vector<int64_t> W_shape = {16, 1, 4, 4};

  std::vector<int8_t> expected_vals = {24, 25, 24, 23, 27, 28, 24, 23, 19, 15, 18, 17, 17, 19, 18, 20, 23, \
                                  24, 22, 25, 28, 26, 24, 21, 15, 16, 20, 19, 20, 19, 17, 20, 23, 25, \
                                  25, 27, 29, 26, 24, 20, 14, 17, 18, 21, 24, 22, 22, 22, 22, 22, 23, \
                                  26, 28, 26, 24, 20, 15, 18, 18, 20, 26, 27, 28, 27, 21, 22, 23, 25, \
                                  26, 23, 24, 21, 17, 20, 22, 22, 25, 26, 25, 25, 21, 23, 24, 24, 27, \
                                  24, 24, 21, 18, 18, 20, 24, 26, 30, 27, 24, 18, 20, 19, 19, 23, 22, \
                                  22, 21, 20, 17, 21, 22, 22, 26, 24, 24, 20, 22, 23, 22, 24, 20, 18, \
                                  16, 17, 17, 22, 23, 21, 22, 21, 22, 20, 21, 19, 21, 24, 22, 20, 17, \
                                  18, 18, 22, 24, 22, 23, 22, 23, 20, 19, 18, 21, 21, 19, 20, 16, 18, \
                                  21, 22, 24, 22, 23, 21, 23, 22, 21, 22, 26, 25, 20, 22, 17, 19, 25, \
                                  24, 26, 24, 22, 21, 22, 25, 23, 22, 25, 25, 24, 28, 22, 21, 26, 23, \
                                  26, 24, 21, 20, 20, 26, 24, 23, 26, 24, 23, 26, 20, 20, 25, 25, 29, \
                                  27, 21, 19, 16, 28, 27, 25, 27, 26, 25, 27, 24, 22, 26, 26, 28, 24, \
                                  18, 18, 14, 26, 25, 23, 23, 26, 26, 29, 27, 21, 23, 22, 25, 26, 22, \
                                  21, 16, 22, 20, 16, 18, 20, 21, 26, 24, 22, 25, 25, 26, 26, 23, 21, \
                                  18, 25, 26, 25, 24, 28, 29, 26, 24, 20, 16, 19, 18, 18, 20, 19, 21, \
                                  24, 24, 23, 26, 29, 27, 25, 22, 16, 16, 21, 20, 22, 20, 18, 21, 24, \
                                  26, 26, 28, 30, 27, 25, 20, 16, 18, 20, 22, 25, 23, 23, 23, 23, 23, \
                                  24, 27, 29, 27, 26, 21, 16, 18, 20, 21, 26, 28, 29, 28, 22, 24, 24, \
                                  26, 27, 24, 24, 22, 18, 21, 22, 23, 26, 26, 26, 26, 22, 24, 24, 24, \
                                  28, 25, 26, 22, 19, 19, 21, 24, 28, 31, 28, 26, 20, 22, 20, 20, 24, \
                                  23, 23, 22, 21, 18, 22, 23, 23, 26, 25, 26, 21, 23, 24, 24, 25, 22, \
                                  19, 16, 18, 18, 23, 24, 22, 23, 22, 23, 21, 22, 20, 22, 25, 22, 22, \
                                  18, 19, 19, 23, 25, 22, 24, 23, 24, 21, 20, 19, 22, 22, 20, 20, 18, \
                                  19, 22, 23, 25, 23, 24, 22, 24, 24, 22, 23, 26, 26, 22, 23, 18, 20, \
                                  26, 25, 26, 24, 24, 22, 22, 26, 24, 22, 26, 26, 24, 29, 24, 22, 26, \
                                  24, 27, 25, 22, 21, 21, 27, 25, 24, 28, 25, 24, 27, 22, 20, 26, 26, \
                                  30, 28, 22, 20, 17, 29, 28, 26, 28, 27, 26, 28, 25, 23, 27, 28, 28, \
                                  24, 19, 18, 15, 27, 26, 24, 24, 26, 27, 30, 28, 22, 24, 24, 26, 26, \
                                  23, 22, 17, 24, 21, 18, 19, 22, 22, 26, 25, 23, 26, 26, 27, 27, 24, \
                                  22, 19, 26, 27, 26, 25, 29, 30, 26, 25, 21, 17, 20, 19, 19, 21, 20, \
                                  22, 25, 26, 24, 27, 30, 28, 26, 23, 17, 18, 22, 21, 22, 21, 19, 22, \
                                  25, 27, 27, 29, 31, 28, 26, 22, 16, 19, 20, 23, 26, 24, 24, 24, 24, \
                                  24, 25, 28, 30, 28, 26, 22, 17, 20, 20, 22, 28, 29, 30, 29, 23, 24, \
                                  25, 27, 28, 25, 26, 23, 19, 22, 24, 24, 27, 28, 27, 27, 23, 25, 26, \
                                  26, 29, 26, 26, 23, 20, 20, 22, 26, 28, 32, 29, 26, 20, 22, 21, 21, \
                                  25, 24, 24, 23, 22, 19, 23, 24, 24, 28, 26, 26, 22, 24, 25, 24, 26, \
                                  22, 20, 18, 19, 19, 24, 25, 23, 24, 23, 24, 22, 23, 21, 23, 26, 24, \
                                  22, 19, 20, 20, 24, 26, 24, 25, 24, 25, 22, 21, 20, 23, 23, 21, 22, \
                                  18, 20, 23, 24, 26, 24, 25, 23, 25, 24, 23, 24, 28, 27, 22, 24, 19, \
                                  21, 27, 26, 28, 26, 24, 23, 24, 27, 25, 24, 27, 27, 26, 30, 24, 23, \
                                  28, 25, 28, 26, 23, 22, 22, 28, 26, 25, 28, 26, 25, 28, 22, 22, 27, \
                                  27, 31, 29, 23, 21, 18, 30, 29, 27, 29, 28, 27, 29, 26, 24, 28, 28, \
                                  30, 26, 20, 20, 16, 28, 27, 25, 25, 28, 28, 31, 29, 23, 25, 24, 27, \
                                  28, 24, 23, 18, 24, 22, 18, 20, 22, 23, 28, 26, 24, 27, 27, 28, 28, \
                                  25, 23, 20, 27, 28, 27, 26, 30, 31, 28, 26, 22, 18, 21, 20, 20, 22, \
                                  21, 23, 26, 26, 25, 28, 31, 29, 27, 24, 18, 18, 23, 22, 24, 22, 20, \
                                  23, 26, 28, 28, 30, 32, 29, 27, 22, 18, 20, 22, 24, 27, 25, 25, 25, \
                                  25, 25, 26, 29, 31, 29, 28, 23, 18, 20, 22, 23, 28, 30, 31, 30, 24, \
                                  26, 26, 28, 29, 26, 26, 24, 20, 23, 24, 25, 28, 28, 28, 28, 24, 26, \
                                  26, 26, 30, 27, 28, 24, 21, 21, 23, 26, 30, 33, 30, 28, 22, 24, 22, \
                                  22, 26, 25, 25, 24, 23, 20, 24, 25, 25, 28, 27, 28, 23, 25, 26, 26, \
                                  27, 24, 21, 18, 20, 20, 25, 26, 24, 25, 24, 25, 23, 24, 22, 24, 27, \
                                  24, 24, 20, 21, 21, 25, 27, 24, 26, 25, 26, 23, 22, 21, 24, 24, 22, \
                                  22, 20, 21, 24, 25, 27, 25, 26, 24, 26, 26, 24, 25, 28, 28, 24, 25, \
                                  20, 22, 28, 27, 28, 26, 26, 24, 24, 28, 26, 24, 28, 28, 26, 31, 26, \
                                  24, 28, 26, 29, 27, 24, 23, 23, 29, 27, 26, 30, 27, 26, 29, 24, 22, \
                                  28, 28, 32, 30, 24, 22, 19, 31, 30, 28, 30, 29, 28, 30, 27, 25, 29, \
                                  30, 30, 26, 21, 20, 17, 29, 28, 26, 26, 28, 29, 32, 30, 24, 26, 26, \
                                  28, 28, 25, 24, 19, 26, 23, 20, 21, 24, 24, 28, 27, 25, 28, 28, 29, \
                                  29, 26, 24, 21, 28, 29, 28, 27, 31, 32, 28, 27, 23, 19, 22, 21, 21, \
                                  23, 22, 24, 27, 28, 26, 29, 32, 30, 28, 25, 19, 20, 24, 23, 24, 23, \
                                  21, 24, 27, 29, 29, 31, 33, 30, 28, 24, 18, 21, 22, 25, 28, 26, 26, \
                                  26, 26, 26, 27, 30, 32, 30, 28, 24, 19, 22, 22, 24, 30, 31, 32, 31, \
                                  25, 26, 27, 29, 30, 27, 28, 25, 21, 24, 26, 26, 29, 30, 29, 29, 25, \
                                  27, 28, 28, 31, 28, 28, 25, 22, 22, 24, 28, 30, 34, 31, 28, 22, 24, \
                                  23, 23, 27, 26, 26, 25, 24, 21, 25, 26, 26, 30, 28, 28, 24, 26, 27, \
                                  26, 28, 24, 22, 20, 21, 21, 26, 27, 25, 26, 25, 26, 24, 25, 23, 25, \
                                  28, 26, 24, 21, 22, 22, 26, 28, 26, 27, 26, 27, 24, 23, 22, 25, 25, \
                                  23, 24, 20, 22, 25, 26, 28, 26, 27, 25, 27, 26, 25, 26, 30, 29, 24, \
                                  26, 21, 23, 29, 28, 30, 28, 26, 25, 26, 29, 27, 26, 29, 29, 28, 32, \
                                  26, 25, 30, 27, 30, 28, 25, 24, 24, 30, 28, 27, 30, 28, 27, 30, 24, \
                                  24, 29, 29, 33, 31, 25, 23, 20, 32, 31, 29, 31, 30, 29, 31, 28, 26, \
                                  30, 30, 32, 28, 22, 22, 18, 30, 29, 27, 27, 30, 30, 33, 31, 25, 27, \
                                  26, 29, 30, 26, 25, 20, 26, 24, 20, 22, 24, 25, 30, 28, 26, 29, 29, \
                                  30, 30, 27, 25, 22, 29, 30, 29, 28, 32, 33, 30, 28, 24, 20, 23, 22, \
                                  22, 24, 23, 25, 28, 28, 27, 30, 33, 31, 29, 26, 20, 20, 25, 24, 26, \
                                  24, 22, 25, 28, 30, 30, 32, 34, 31, 29, 24, 20, 22, 24, 26, 29, 27, \
                                  27, 27, 27, 27, 28, 31, 33, 31, 30, 25, 20, 22, 24, 25, 30, 32, 33, \
                                  32, 26, 28, 28, 30, 31, 28, 28, 26, 22, 25, 26, 27, 30, 30, 30, 30, \
                                  26, 28, 28, 28, 32, 29, 30, 26, 23, 23, 25, 28, 32, 35, 32, 30, 24, \
                                  26, 24, 24, 28, 27, 27, 26, 25, 22, 26, 27, 27, 30, 29, 30, 25, 27, \
                                  28, 28, 29, 26, 23, 20, 22, 22, 27, 28, 26, 27, 26, 27, 25, 26, 24, \
                                  26, 29, 26, 26, 22, 23, 23, 27, 29, 26, 28, 27, 28, 25, 24, 23, 26, \
                                  26, 24, 24, 22, 23, 26, 27, 29, 27, 28, 26, 28, 28, 26, 27, 30, 30, \
                                  26, 27, 22, 24, 30, 29, 30, 28, 28, 26, 26, 30, 28, 26, 30, 30, 28, \
                                  33, 28, 26, 30, 28, 31, 29, 26, 25, 25, 31, 29, 28, 32, 29, 28, 31, \
                                  26, 24, 30, 30, 34, 32, 26, 24, 21, 33, 32, 30, 32, 31, 30, 32, 29, \
                                  27, 31, 32, 32, 28, 23, 22, 19, 31, 30, 28, 28, 30, 31, 34, 32, 26, \
                                  28, 28, 30, 30, 27, 26, 21, 28, 25, 22, 23, 26, 26, 30, 29, 27, 30, \
                                  30, 31, 31, 28, 26, 23, 30, 31, 30, 29, 33, 34, 30, 29, 25, 21, 24, \
                                  23, 23, 25, 24, 26, 29, 30, 28, 31, 34, 32, 30, 27, 21, 22, 26, 25, \
                                  26, 25, 23, 26, 29, 31, 31, 33, 35, 32, 30, 26, 20, 23, 24, 27, 30, \
                                  28, 28, 28, 28, 28, 29, 32, 34, 32, 30, 26, 21, 24, 24, 26, 32, 33, \
                                  34, 33, 27, 28, 29, 31, 32, 29, 30, 27, 23, 26, 28, 28, 31, 32, 31, \
                                  31, 27, 29, 30, 30, 33, 30, 30, 27, 24, 24, 26, 30, 32, 36, 33, 30, \
                                  24, 26, 25, 25, 29, 28, 28, 27, 26, 23, 27, 28, 28, 32, 30, 30, 26, \
                                  28, 29, 28, 30, 26, 24, 22, 23, 23, 28, 29, 27, 28, 27, 28, 26, 27, \
                                  25, 27, 30, 28, 26, 23, 24, 24, 28, 30, 28, 29, 28, 29, 26, 25, 24, \
                                  27, 27, 25, 26, 22, 24, 27, 28, 30, 28, 29, 27, 29, 28, 27, 28, 32, \
                                  31, 26, 28, 23, 25, 31, 30, 32, 30, 28, 27, 28, 31, 29, 28, 31, 31, \
                                  30, 34, 28, 27, 32, 29, 32, 30, 27, 26, 26, 32, 30, 29, 32, 30, 29, \
                                  32, 26, 26, 31, 31, 35, 33, 27, 25, 22, 34, 33, 31, 33, 32, 31, 33, \
                                  30, 28, 32, 32, 34, 30, 24, 24, 20, 32, 31, 29, 29, 32, 32, 35, 33, \
                                  27, 29, 28, 31, 32, 28, 27, 22, 28, 26, 22, 24, 26, 27, 32, 30, 28, \
                                  31, 31, 32, 32, 29, 27, 24, 31, 32, 31, 30, 34, 35, 32, 30, 26, 22, \
                                  25, 24, 24, 26, 25, 27, 30, 30, 29, 32, 35, 33, 31, 28, 22, 22, 27, \
                                  26, 28, 26, 24, 27, 30, 32, 32, 34, 36, 33, 31, 26, 22, 24, 26, 28, \
                                  31, 29, 29, 29, 29, 29, 30, 33, 35, 33, 32, 27, 22, 24, 26, 27, 32, \
                                  34, 35, 34, 28, 30, 30, 32, 33, 30, 30, 28, 24, 27, 28, 29, 32, 32, \
                                  32, 32, 28, 30, 30, 30, 34, 31, 32, 28, 25, 25, 27, 30, 34, 37, 34, \
                                  32, 26, 28, 26, 26, 30, 29, 29, 28, 27, 24, 28, 29, 29, 32, 31, 32, \
                                  27, 29, 30, 30, 31, 28, 25, 22, 24, 24, 29, 30, 28, 29, 28, 29, 27, \
                                  28, 26, 28, 31, 28, 28, 24, 25, 25, 29, 31, 28, 30, 29, 30, 27, 26, \
                                  25, 28, 28, 26, 26, 24, 25, 28, 29, 31, 29, 30, 28, 30, 30, 28, 29, \
                                  32, 32, 28, 29, 24, 26, 32, 31, 32, 30, 30, 28, 28, 32, 30, 28, 32, \
                                  32, 30, 35, 30, 28, 32, 30, 33, 31, 28, 27, 27, 33, 31, 30, 34, 31, \
                                  30, 33, 28, 26, 32, 32, 36, 34, 28, 26, 23, 35, 34, 32, 34, 33, 32, \
                                  34, 31, 29, 33, 34, 34, 30, 25, 24, 21, 33, 32, 30, 30, 32, 33, 36, \
                                  34, 28, 30, 30, 32, 32, 29, 28, 23, 30, 27, 24, 25, 28, 28, 32, 31, \
                                  29, 32, 32, 33, 33, 30, 28, 25, 32, 33, 32, 31, 35, 36, 32, 31, 27, \
                                  23, 26, 25, 25, 27, 26, 28, 31, 32, 30, 33, 36, 34, 32, 29, 23, 24, \
                                  28, 27, 28, 27, 25, 28, 31, 33, 33, 35, 37, 34, 32, 28, 22, 25, 26, \
                                  29, 32, 30, 30, 30, 30, 30, 31, 34, 36, 34, 32, 28, 23, 26, 26, 28, \
                                  34, 35, 36, 35, 29, 30, 31, 33, 34, 31, 32, 29, 25, 28, 30, 30, 33, \
                                  34, 33, 33, 29, 31, 32, 32, 35, 32, 32, 29, 26, 26, 28, 32, 34, 38, \
                                  35, 32, 26, 28, 27, 27, 31, 30, 30, 29, 28, 25, 29, 30, 30, 34, 32, \
                                  32, 28, 30, 31, 30, 32, 28, 26, 24, 25, 25, 30, 31, 29, 30, 29, 30, \
                                  28, 29, 27, 29, 32, 30, 28, 25, 26, 26, 30, 32, 30, 31, 30, 31, 28, \
                                  27, 26, 29, 29, 27, 28, 24, 26, 29, 30, 32, 30, 31, 29, 31, 30, 29, \
                                  30, 34, 33, 28, 30, 25, 27, 33, 32, 34, 32, 30, 29, 30, 33, 31, 30, \
                                  33, 33, 32, 36, 30, 29, 34, 31, 34, 32, 29, 28, 28, 34, 32, 31, 34, \
                                  32, 31, 34, 28, 28, 33, 33, 37, 35, 29, 27, 24, 36, 35, 33, 35, 34, \
                                  33, 35, 32, 30, 34, 34, 36, 32, 26, 26, 22, 34, 33, 31, 31, 34, 34, \
                                  37, 35, 29, 31, 30, 33, 34, 30, 29, 24, 30, 28, 24, 26, 28, 29, 34, \
                                  32, 30, 33, 33, 34, 34, 31, 29, 26, 33, 34, 33, 32, 36, 37, 34, 32, \
                                  28, 24, 27, 26, 26, 28, 27, 29, 32, 32, 31, 34, 37, 35, 33, 30, 24, \
                                  24, 29, 28, 30, 28, 26, 29, 32, 34, 34, 36, 38, 35, 33, 28, 24, 26, \
                                  28, 30, 33, 31, 31, 31, 31, 31, 32, 35, 37, 35, 34, 29, 24, 26, 28, \
                                  29, 34, 36, 37, 36, 30, 32, 32, 34, 35, 32, 32, 30, 26, 29, 30, 31, \
                                  34, 34, 34, 34, 30, 32, 32, 32, 36, 33, 34, 30, 27, 27, 29, 32, 36, \
                                  39, 36, 34, 28, 30, 28, 28, 32, 31, 31, 30, 29, 26, 30, 31, 31, 34, \
                                  33, 34, 29, 31, 32, 32, 33, 30, 27, 24, 26, 26, 31, 32, 30, 31, 30, \
                                  31, 29, 30, 28, 30, 33, 30, 30, 26, 27, 27, 31, 33, 30, 32, 31, 32, \
                                  29, 28, 27, 30, 30, 28, 28, 26, 27, 30, 31, 33, 31, 32, 30, 32, 32, \
                                  30, 31, 34, 34, 30, 31, 26, 28, 34, 33, 34, 32, 32, 30, 30, 34, 32, \
                                  30, 34, 34, 32, 37, 32, 30, 34, 32, 35, 33, 30, 29, 29, 35, 33, 32, \
                                  36, 33, 32, 35, 30, 28, 34, 34, 38, 36, 30, 28, 25, 37, 36, 34, 36, \
                                  35, 34, 36, 33, 31, 35, 36, 36, 32, 27, 26, 23, 35, 34, 32, 32, 34, \
                                  35, 38, 36, 30, 32, 32, 34, 34, 31, 30, 25, 32, 29, 26, 27, 30, 30, \
                                  34, 33, 31, 34, 34, 35, 35, 32, 30, 27, 34, 35, 34, 33, 37, 38, 34, \
                                  33, 29, 25, 28, 27, 27, 29, 28, 30, 33, 34, 32, 35, 38, 36, 34, 31, \
                                  25, 26, 30, 29, 30, 29, 27, 30, 33, 35, 35, 37, 39, 36, 34, 30, 24, \
                                  27, 28, 31, 34, 32, 32, 32, 32, 32, 33, 36, 38, 36, 34, 30, 25, 28, \
                                  28, 30, 36, 37, 38, 37, 31, 32, 33, 35, 36, 33, 34, 31, 27, 30, 32, \
                                  32, 35, 36, 35, 35, 31, 33, 34, 34, 37, 34, 34, 31, 28, 28, 30, 34, \
                                  36, 40, 37, 34, 28, 30, 29, 29, 33, 32, 32, 31, 30, 27, 31, 32, 32, \
                                  36, 34, 34, 30, 32, 33, 32, 34, 30, 28, 26, 27, 27, 32, 33, 31, 32, \
                                  31, 32, 30, 31, 29, 31, 34, 32, 30, 27, 28, 28, 32, 34, 32, 33, 32, \
                                  33, 30, 29, 28, 31, 31, 29, 30, 26, 28, 31, 32, 34, 32, 33, 31, 33, \
                                  32, 31, 32, 36, 35, 30, 32, 27, 29, 35, 34, 36, 34, 32, 31, 32, 35, \
                                  33, 32, 35, 35, 34, 38, 32, 31, 36, 33, 36, 34, 31, 30, 30, 36, 34, \
                                  33, 36, 34, 33, 36, 30, 30, 35, 35, 39, 37, 31, 29, 26, 38, 37, 35, \
                                  37, 36, 35, 37, 34, 32, 36, 36, 38, 34, 28, 28, 24, 36, 35, 33, 33, \
                                  36, 36, 39, 37, 31, 33, 32, 35, 36, 32, 31, 26, 32, 30, 26, 28, 30, \
                                  31, 36, 34, 32, 35, 35, 36, 36, 33, 31, 28, 35, 36, 35, 34, 38, 39, \
                                  36, 34, 30, 26, 29, 28, 28, 30, 29, 31, 34, 34, 33, 36, 39, 37, 35, \
                                  32, 26, 26, 31, 30, 32, 30, 28, 31, 34, 36, 36, 38, 40, 37, 35, 30, \
                                  26, 28, 30, 32, 35, 33, 33, 33, 33, 33, 34, 37, 39, 37, 36, 31, 26, \
                                  28, 30, 31, 36, 38, 39, 38, 32, 34, 34, 36, 37, 34, 34, 32, 28, 31, \
                                  32, 33, 36, 36, 36, 36, 32, 34, 34, 34, 38, 35, 36, 32, 29, 29, 31, \
                                  34, 38, 41, 38, 36, 30, 32, 30, 30, 34, 33, 33, 32, 31, 28, 32, 33, \
                                  33, 36, 35, 36, 31, 33, 34, 34, 35, 32, 29, 26, 28, 28, 33, 34, 32, \
                                  33, 32, 33, 31, 32, 30, 32, 35, 32, 32, 28, 29, 29, 33, 35, 32, 34, \
                                  33, 34, 31, 30, 29, 32, 32, 30, 30, 28, 29, 32, 33, 35, 33, 34, 32, \
                                  34, 34, 32, 33, 36, 36, 32, 33, 28, 30, 36, 35, 36, 34, 34, 32, 32, \
                                  36, 34, 32, 36, 36, 34, 39, 34, 32, 36, 34, 37, 35, 32, 31, 31, 37, \
                                  35, 34, 38, 35, 34, 37, 32, 30, 36, 36, 40, 38, 32, 30, 27, 39, 38, \
                                  36, 38, 37, 36, 38, 35, 33, 37, 38, 38, 34, 29, 28, 25, 37, 36, 34, \
                                  34, 36, 37, 40, 38, 32, 34, 34, 36, 36, 33, 32, 27, 34, 31, 28, 29, \
                                  32, 32, 36, 35, 33, 36, 36, 37, 37, 34, 32, 29, 36, 37, 36, 35, 39, \
                                  40, 36, 35, 31, 27, 30, 29, 29, 31, 30, 32, 35, 36, 34, 37, 40, 38, \
                                  36, 33, 27, 28, 32, 31, 32, 31, 29, 32, 35, 37, 37, 39, 41, 38, 36, \
                                  32, 26, 29, 30, 33, 36, 34, 34, 34, 34, 34, 35, 38, 40, 38, 36, 32, \
                                  27, 30, 30, 32, 38, 39, 40, 39, 33, 34, 35, 37, 38, 35, 36, 33, 29, \
                                  32, 34, 34, 37, 38, 37, 37, 33, 35, 36, 36, 39, 36, 36, 33, 30, 30, \
                                  32, 36, 38, 42, 39, 36, 30, 32, 31, 31, 35, 34, 34, 33, 32, 29, 33, \
                                  34, 34, 38, 36, 36, 32, 34, 35, 34, 36, 32, 30, 28, 29, 29, 34, 35, \
                                  33, 34, 33, 34, 32, 33, 31, 33, 36, 34, 32, 29, 30, 30, 34, 36, 34, \
                                  35, 34, 35, 32, 31, 30, 33, 33, 31, 32, 28, 30, 33, 34, 36, 34, 35, \
                                  33, 35, 34, 33, 34, 38, 37, 32, 34, 29, 31, 37, 36, 38, 36, 34, 33, \
                                  34, 37, 35, 34, 37, 37, 36, 40, 34, 33, 38, 35, 38, 36, 33, 32, 32, \
                                  38, 36, 35, 38, 36, 35, 38, 32, 32, 37, 37, 41, 39, 33, 31, 28, 40, \
                                  39, 37, 39, 38, 37, 39, 36, 34, 38, 38, 40, 36, 30, 30, 26, 38, 37, \
                                  35, 35, 38, 38, 41, 39, 33, 35, 34, 37, 38, 34, 33, 28, 34, 32, 28, \
                                  30, 32, 33, 38, 36, 34, 37, 37, 38, 38, 35, 33, 30, 37, 38, 37, 36, \
                                  40, 41, 38, 36, 32, 28, 31, 30, 30, 32, 31, 33, 36, 36, 35, 38, 41, \
                                  39, 37, 34, 28, 28, 33, 32, 34, 32, 30, 33, 36, 38, 38, 40, 42, 39, \
                                  37, 32, 28, 30, 32, 34, 37, 35, 35, 35, 35, 35, 36, 39, 41, 39, 38, \
                                  33, 28, 30, 32, 33, 38, 40, 41, 40, 34, 36, 36, 38, 39, 36, 36, 34, \
                                  30, 33, 34, 35, 38, 38, 38, 38, 34, 36, 36, 36, 40, 37, 38, 34, 31, \
                                  31, 33, 36, 40, 43, 40, 38, 32, 34, 32, 32, 36, 35, 35, 34, 33, 30, \
                                  34, 35, 35, 38, 37, 38, 33, 35, 36, 36, 37, 34, 31, 28, 30, 30, 35, \
                                  36, 34, 35, 34, 35, 33, 34, 32, 34, 37, 34, 34, 30, 31, 31, 35, 37, \
                                  34, 36, 35, 36, 33, 32, 31, 34, 34, 32, 32, 30, 31, 34, 35, 37, 35, \
                                  36, 34, 36, 36, 34, 35, 38, 38, 34, 35, 30, 32, 38, 37, 38, 36, 36, \
                                  34, 34, 38, 36, 34, 38, 38, 36, 41, 36, 34, 38, 36, 39, 37, 34, 33, \
                                  33, 39, 37, 36, 40, 37, 36, 39, 34, 32, 38, 38, 42, 40, 34, 32, 29, \
                                  41, 40, 38, 40, 39, 38, 40, 37, 35, 39, 40, 40, 36, 31, 30, 27, 39, \
                                  38, 36, 36, 38, 39, 42, 40, 34, 36, 36, 38, 38, 35, 34, 29, 36, 33, \
                                  30, 31, 34, 34, 38, 37, 35, 38, 38, 39, 39, 36, 34, 31, 38, 39, 38, \
                                  37, 41, 42, 38, 37, 33, 29, 32, 31, 31, 33, 32, 34, 37, 38, 36, 39, \
                                  42, 40, 38, 35, 29, 30, 34, 33, 34, 33, 31, 34, 37, 39, 39, 41, 43, \
                                  40, 38, 34, 28, 31, 32, 35, 38, 36, 36, 36, 36, 36, 37, 40, 42, 40, \
                                  38, 34, 29, 32, 32, 34, 40, 41, 42, 41, 35, 36, 37, 39, 40, 37, 38, \
                                  35, 31, 34, 36, 36, 39, 40, 39, 39, 35, 37, 38, 38, 41, 38, 38, 35, \
                                  32, 32, 34, 38, 40, 44, 41, 38, 32, 34, 33, 33, 37, 36, 36, 35, 34, \
                                  31, 35, 36, 36, 40, 38, 38, 34, 36, 37, 36, 38, 34, 32, 30, 31, 31, \
                                  36, 37, 35, 36, 35, 36, 34, 35, 33, 35, 38, 36, 34, 31, 32, 32, 36, \
                                  38, 36, 37, 36, 37, 34, 33, 32, 35, 35, 33, 34, 30, 32, 35, 36, 38, \
                                  36, 37, 35, 37, 36, 35, 36, 40, 39, 34, 36, 31, 33, 39, 38, 40, 38, \
                                  36, 35, 36, 39, 37, 36, 39, 39, 38, 42, 36, 35, 40, 37, 40, 38, 35, \
                                  34, 34, 40, 38, 37, 40, 38, 37, 40, 34, 34, 39, 39, 43, 41, 35, 33, \
                                  30, 42, 41, 39, 41, 40, 39, 41, 38, 36, 40, 40, 42, 38, 32, 32, 28, \
                                  40, 39, 37, 37, 40, 40, 43, 41, 35, 37, 36, 39, 40, 36, 35, 30, 36, \
                                  34, 30, 32, 34, 35, 40, 38, 36, 39, 39, 40, 40, 37, 35, 32, 39, 40, \
                                  39, 38, 42, 43, 40, 38, 34, 30, 33, 32, 32, 34, 33, 35, 38, 38, 37, \
                                  40, 43, 41, 39, 36, 30, 30, 35, 34, 36, 34, 32, 35, 38, 40, 40, 42, \
                                  44, 41, 39, 34, 30, 32, 34, 36, 39, 37, 37, 37, 37, 37, 38, 41, 43, \
                                  41, 40, 35, 30, 32, 34, 35, 40, 42, 43, 42, 36, 38, 38, 40, 41, 38, \
                                  38, 36, 32, 35, 36, 37, 40, 40, 40, 40, 36, 38, 38, 38, 42, 39, 40, \
                                  36, 33, 33, 35, 38, 42, 45, 42, 40, 34, 36, 34, 34, 38, 37, 37, 36, \
                                  35, 32, 36, 37, 37, 40, 39, 40, 35, 37, 38, 38, 39, 36, 33, 30, 32, \
                                  32, 37, 38, 36, 37, 36, 37, 35, 36, 34, 36, 39, 36, 36, 32, 33, 33, \
                                  37, 39, 36, 38, 37, 38, 35, 34, 33, 36, 36, 34, 34, 32, 33, 36, 37, \
                                  39, 37, 38, 36, 38, 38, 36, 37, 40, 40, 36, 37, 32, 34, 40, 39, 40, \
                                  38, 38, 36, 36, 40, 38, 36, 40, 40, 38, 43, 38, 36, 40, 38, 41, 39, \
                                  36, 35, 35, 41, 39, 38, 42, 39, 38, 41, 36, 34, 40, 40, 44, 42, 36, \
                                  34, 31, 43, 42, 40, 42, 41, 40, 42, 39, 37, 41, 42, 42, 38, 33, 32, \
                                  29, 41, 40, 38, 38, 40, 41, 44, 42, 36, 38, 38, 40, 40, 37, 36, 31, \
                                  38, 35, 32, 33, 36, 36, 40, 39, 37, 40, 40, 41, 41, 38, 36, 33};
  std::vector<int64_t> Y_shape = {1, 16, 16, 16};

  test.AddInput<int8_t>("x", X_shape, X);
  test.AddInput<float>("x_scale", {}, {1});
  test.AddInput<int8_t>("x_zero_point", {}, {0});

  test.AddInput<int8_t>("w", W_shape, W);
  test.AddInput<float>("w_scale", {}, {1});
  test.AddInput<int8_t>("w_zero_point", {}, {0});

  test.AddInput<float>("y_scale", {}, {4});
  test.AddInput<int8_t>("y_zero_point", {}, {0});

  test.AddInput<int32_t>("B", {16}, {4, 2*4, 3*4, 4*4, 5*4, 6*4, 7*4, 8*4, 9*4, 10*4, 11*4, 12*4, 13*4, 14*4, 15*4, 16*4});

  test.AddOutput<int8_t>("y", Y_shape, expected_vals);

  test.Run();
}


TEST(ConvTest, QLinearConvSimple2DTest) {
  OpTester test("QLinearConv", 10);

  std::vector<uint8_t> X = {110, 35, 111, 107, 5, 79, 103, 5, 12, 123, 34, 40, 41, 102, 33, 117, 109, 73, 51, 123, 6, 126, 56, 111, 111};
  std::vector<int64_t> X_shape = {1, 1, 5, 5};

  std::vector<uint8_t> W = {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1};
  std::vector<int64_t> W_shape = {1, 1, 4, 4};

  std::vector<uint8_t> expected_vals = {10, 9, 9, 10};
  std::vector<int64_t> Y_shape = {1, 1, 2, 2};

  test.AddInput<uint8_t>("x", X_shape, X);
  test.AddInput<float>("x_scale", {}, {1});
  test.AddInput<uint8_t>("x_zero_point", {}, {0});

  test.AddInput<uint8_t>("w", W_shape, W);
  test.AddInput<float>("w_scale", {}, {1});
  test.AddInput<uint8_t>("w_zero_point", {}, {0});

  test.AddInput<float>("y_scale", {}, {128});
  test.AddInput<uint8_t>("y_zero_point", {}, {0});

  test.AddInput<int32_t>("B", {1}, {100});

  test.AddOutput<uint8_t>("y", Y_shape, expected_vals);

  test.Run();
}


TEST(ConvTest, QLinearConvSignedTiny2DTest) {
  OpTester test("QLinearConv", 10);

  std::vector<int8_t> X = {110, 35, 111, 107, 5, 79, 103, 5, 12, 123, 34, 40, 41, 102, 33, 117, 109, 73, 51, 123, 6, 126, 56, 111, 111};
  std::vector<int64_t> X_shape = {1, 1, 5, 5};

  std::vector<int8_t> W = {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1};
  std::vector<int64_t> W_shape = {1, 1, 4, 4};

  std::vector<int8_t> expected_vals = {10, 9, 9, 10};
  std::vector<int64_t> Y_shape = {1, 1, 2, 2};

  test.AddInput<int8_t>("x", X_shape, X);
  test.AddInput<float>("x_scale", {}, {1});
  test.AddInput<int8_t>("x_zero_point", {}, {0});

  test.AddInput<int8_t>("w", W_shape, W);
  test.AddInput<float>("w_scale", {}, {1});
  test.AddInput<int8_t>("w_zero_point", {}, {0});

  test.AddInput<float>("y_scale", {}, {128});
  test.AddInput<int8_t>("y_zero_point", {}, {0});

  test.AddInput<int32_t>("B", {1}, {100});

  test.AddOutput<int8_t>("y", Y_shape, expected_vals);

  test.Run();
}

TEST(QLinearConvTest, Conv2DTest) {
  QuantizedTensor X({0.45246148109436035f, 0.15498268604278564f, 0.11199361085891724f, -0.39421093463897705f,
                     0.2626858949661255f, 0.13414543867111206f, -0.27184486389160156f, -0.43028733134269714f,
                     -0.26825493574142456f, 0.3893144130706787f, -0.13631996512413025f, -0.009590476751327515f,
                     -0.48771554231643677f, -0.25256502628326416f, -0.2812897562980652f, 0.4043201804161072f,
                     0.07795023918151855f, 0.326981782913208f, 0.13114392757415771f, -0.4416425824165344f,
                     0.12446999549865723f, 0.36739975214004517f, 0.1698915958404541f, 0.2008744478225708f,
                     0.23339951038360596f, 0.38613730669021606f, 0.11117297410964966f, 0.3877097964286804f,
                     0.20812749862670898f, -0.34297940135002136f, -0.029246658086776733f, -0.20483523607254028f,
                     -0.19244328141212463f, -0.11104947328567505f, -0.32830488681793213f, -0.01800677180290222f,
                     0.3618946671485901f, -0.40949052572250366f, -0.18248388171195984f, -0.3349453806877136f,
                     -0.34091079235076904f, 0.006497859954833984f, 0.4537564516067505f, 0.08006560802459717f,
                     -0.14788749814033508f, 0.034442365169525146f, -0.33322954177856445f, 0.06049239635467529f,
                     0.42619407176971436f});
  QuantizedTensor W({-0.4406261742115021f});
  QuantizedTensor Y({-0.19936637580394745f, -0.06828942894935608f, -0.04934731498360634f, 0.17369966208934784f,
                     -0.11574628204107285f, -0.05910799279808998f, 0.1197819635272026f, 0.18959586322307587f,
                     0.1182001456618309f, -0.17154212296009064f, 0.06006614491343498f, 0.0042258151806890965f,
                     0.21490024030208588f, 0.11128675937652588f, 0.12394362688064575f, -0.17815405130386353f,
                     -0.034346915781497955f, -0.14407673478126526f, -0.05778544768691063f, 0.19459928572177887f,
                     -0.05484473705291748f, -0.16188594698905945f, -0.07485868036746979f, -0.08851054310798645f,
                     -0.10284193605184555f, -0.17014220356941223f, -0.04898572340607643f, -0.17083507776260376f,
                     -0.09170642495155334f, 0.1511256992816925f, 0.012886842712759972f, 0.09025576710700989f,
                     0.08479554951190948f, 0.0489313043653965f, 0.14465972781181335f, 0.007934254594147205f,
                     -0.15946026146411896f, 0.1804322451353073f, 0.08040717244148254f, 0.1475857049226761f,
                     0.15021422505378723f, -0.0028631272725760937f, -0.19993697106838226f, -0.03527900204062462f,
                     0.06516310572624207f, -0.015176207758486271f, 0.14682966470718384f, -0.02665453404188156f,
                     -0.18779225647449493f});

  OpTester test("QLinearConv", 10);

  TestQLinearConvOp(test,
                    X, {1, 1, 7, 7},
                    W, {1, 1, 1, 1},
                    nullptr,
                    Y, {1, 1, 7, 7});
}

TEST(QLinearConvTest, Conv3DTest) {
  QuantizedTensor X({0.010772407054901123f, -0.43806642293930054f, 0.455391526222229f, -0.28657248616218567f,
                     0.45676887035369873f, -0.0320507287979126f, 0.4229400157928467f, -0.18730869889259338f,
                     -0.45851585268974304f, 0.042054951190948486f, -0.13332295417785645f, -0.25374430418014526f,
                     -0.23845627903938293f, 0.12214112281799316f, -0.1778157651424408f, 0.1891845464706421f,
                     0.37962496280670166f, -0.033982306718826294f, 0.12737131118774414f, -0.040284961462020874f,
                     0.46427029371261597f, -0.22687292098999023f, 0.17398333549499512f, -0.3014046251773834f,
                     -0.4043419063091278f, -0.33206477761268616f, 0.04655301570892334f, -0.4947906732559204f,
                     0.0755157470703125f, 0.1173025369644165f, 0.47043120861053467f, 0.4824737310409546f,
                     -0.37734976410865784f, -0.056491583585739136f, -0.10790631175041199f, 0.043476223945617676f,
                     0.24469023942947388f, -0.4100031852722168f, 0.0616222620010376f, 0.2296960949897766f,
                     0.27883386611938477f, 0.08150351047515869f, 0.2453773021697998f, 0.08250969648361206f,
                     -0.1471814215183258f, -0.43011274933815f, 0.027180075645446777f, 0.3605625033378601f,
                     0.24954384565353394f, -0.22505927085876465f, -0.36272895336151123f, -0.47674262523651123f,
                     0.11275297403335571f, 0.49773406982421875f, 0.2686365246772766f, 0.025525271892547607f,
                     -0.3037869930267334f, 0.41126757860183716f, 0.36149072647094727f, 0.00883406400680542f,
                     -0.07959523797035217f, 0.3601323366165161f, 0.17322391271591187f, -0.012007325887680054f});
  QuantizedTensor W({0.32824617624282837f});
  QuantizedTensor Y({0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f,
                     0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f,
                     0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0035360013134777546f, 0.14948052167892456f, 0.0f,
                     0.0f, -0.15050607919692993f, -0.043762750923633575f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f,
                     0.0f, 0.0f, 0.0f, 0.0f, 0.0f, -0.12386361509561539f, -0.03541983291506767f, 0.0f,
                     0.0f, 0.09152615070343018f, 0.08054415881633759f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f,
                     0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f,
                     0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f});

  OpTester test("QLinearConv", 10);
  test.AddAttribute("pads", std::vector<int64_t>{2, 2, 2, 2, 2, 2});
  test.AddAttribute("strides", std::vector<int64_t>{2, 2, 2});

  TestQLinearConvOp(test,
                    X, {1, 1, 4, 4, 4},
                    W, {1, 1, 1, 1, 1},
                    nullptr,
                    Y, {1, 1, 4, 4, 4});
}

TEST(QLinearConvTest, WithBias_2D) {
  QuantizedTensor X({6, 81, 214, 151, 234, 42, 50, 89, 30, 91, 125, 141, 52, 31, 58, 224, 84, 251, 67, 137,
                     223, 119, 79, 220, 249, 75, 131, 246, 113, 56, 54, 197, 110, 142, 126, 171, 53, 228,
                     240, 83, 229, 218, 185, 9, 80, 116, 176, 193, 175, 253},
                    0.01f,
                    135);
  QuantizedTensor W({234, 229, 13, 187, 98, 161, 246, 188, 252, 107, 49, 72, 53, 212, 175, 47, 21, 14, 86,
                     230, 16, 177, 82, 166, 75, 220, 169, 119, 34, 205, 27, 9, 44, 74, 40, 8, 28, 139, 240,
                     106, 63, 2, 255, 156, 128, 222, 73, 51, 66, 48, 81, 247, 180, 91, 206, 239, 190, 146,
                     227, 235, 10, 130, 95, 232, 121, 133, 231, 162, 108, 105, 254, 143},
                    0.15f,
                    110);
  QuantizedBiasTensor B({-1123, 3212, 1723, -621}, X.scale_ * W.scale_);
  QuantizedTensor Y({67, 81, 66, 75, 71, 101, 20, 8, 44, 94, 83, 73, 133, 125, 54, 144, 165, 56, 53, 88,
                     130, 118, 170, 168, 140, 109, 103, 80, 122, 142, 129, 100, 39, 61, 141, 133, 59, 155,
                     68, 129, 74, 132, 83, 143, 146, 152, 81, 127, 82, 112, 131, 64, 82, 68, 93, 149, 146,
                     137, 201, 118, 112, 183, 171, 144, 85, 122, 86, 63, 163, 245, 95, 152, 126, 80, 82,
                     49, 136, 160, 187, 147, 29, 20, 135, 174, 126, 124, 36, 56, 0, 83, 134, 171, 119, 109,
                     85, 155, 157, 167, 194, 130},
                    0.75f,
                    121);

  OpTester test("QLinearConv", 10);
  test.AddAttribute("pads", std::vector<int64_t>{1, 1, 1, 1});

  // TODO: nGraph fails to handle the optional bias vector correctly.
  TestQLinearConvOp(test,
                    X, {1, 2, 5, 5},
                    W, {4, 2, 3, 3},
                    &B,
                    Y, {1, 4, 5, 5},
                    {kNGraphExecutionProvider});
}

TEST(QLinearConvTest, WithGroup_2D) {
  QuantizedTensor X({98, 166, 219, 195, 46, 97, 27, 211, 239, 1, 28, 208, 143, 144, 215, 252, 79, 5, 154,
                     56, 122, 191, 94, 25, 221, 48, 37, 182, 68, 245, 210, 206, 183, 22, 163, 104, 242,
                     112, 161, 66, 181, 235, 117, 75, 236, 61, 115, 36, 120, 253, 165, 214, 159, 132, 11,
                     201, 30, 249, 89, 171, 186, 67, 225, 197, 135, 142, 241, 169, 170, 164, 178, 58, 50,
                     51, 200, 43, 199, 126, 222, 123, 227, 42, 3, 21, 124, 220, 24, 47, 63, 110},
                    0.01f,
                    135);
  QuantizedTensor W({220, 111, 73, 254, 235, 151, 6, 156, 129, 204, 234, 198, 44, 89, 202, 82, 118, 189,
                     71, 120, 123, 121, 110, 83, 173, 248, 108, 229, 124, 68, 85, 239, 133, 213, 112, 122,
                     170, 231, 225, 195, 192, 9, 232, 97, 160, 227, 67, 137},
                    0.15f,
                    110);
  QuantizedBiasTensor B({-1853, 598, -17854, 14592, 42, -366}, X.scale_ * W.scale_);
  QuantizedTensor Y({113, 128, 70, 64, 125, 162, 80, 189, 112, 147, 121, 111, 96, 68, 94, 101, 77, 88, 223,
                     128, 163, 194, 138, 164, 122, 109, 117, 91, 72, 121, 134, 155, 127, 125, 98, 128},
                    0.75f,
                    121);

  OpTester test("QLinearConv", 10);
  test.AddAttribute("group", static_cast<int64_t>(3));
  test.AddAttribute("pads", std::vector<int64_t>{0, 0, 1, 1});
  test.AddAttribute("strides", std::vector<int64_t>{2, 2});

  // TODO: nGraph rejects grouped convolutions with bias.
  TestQLinearConvOp(test,
                    X, {1, 6, 3, 5},
                    W, {6, 2, 2, 2},
                    &B,
                    Y, {1, 6, 2, 3},
                    {kNGraphExecutionProvider});
}

}  // namespace
}  // namespace test
}  // namespace onnxruntime
